# FTPサーバのファイルのタイムスタンプを更新するツール

このPerlスクリプトは、ファイルをFTPサーバからダウンロードして削除し、
再度アップロードする事でタイムスタンプの更新を行います。  
指定されたディレクトリ配下のツリー構造をサーチし、
すべての自分のファイルを更新対象とします。  
タイムスタンプを新しくするだけであり、
ファイルの改名や内容変更等は行いません。

## プラットホーム

Windows、Linux の何れでも動作します。

## 準備

スクリプトの最初の方にある「設定値1」、「設定値2」
の所の値はあくまで例ですので、お使いになる環境に合わせて変更して下さい。

 - $host
     - FTPサーバのホスト名又はIPアドレス
 - $pasv
     - PORTモードの場合は0、PASVモードの場合は0以外の値にします。
 - $acnt
     - FTPサーバのログインアカウント
 - $pswd
     - パスワード
 - $wdir
     - このスクリプトでは、冒頭に記したとおりダウンロード動作を行います。  
       ダウンロードの作業ファイルを格納する、
       ローカルマシン上のディレクトリを指定します。  
       ※スクリプトの動作が正常終了すると作業ファイルは削除されます。
 - $lf
     - 処理中に一時的に作成されるログファイルのフルパス名  
       ※スクリプトの動作が正常終了するとログファイルは削除されます。

(注) $wdir、$lf に於いて、
Linuxではディレクトリの区切りにスラッシュ(/)を用いて下さい。

 - $patd、$patf
     - 通常は変更不要 (後述)
 - @ftps
     - FTPサーバ内で更新対象とするディレクトリのトップ階層  
       スクリプトの例では、FTPサーバにログイン後に「chdir abc」、「chdir def」
       を行ったディレクトリ(要するに、サーバのルート/abc/def/ )
       以下の階層に対して更新処理を行います。  
       ログイン階層の配下全部を更新対象としたい場合は、@ftps 
       に何も設定しないで下さい。

## 実行方法

引数はありません。

> perl dirsrch_touchmyfile.pl

## 実行結果

スクリプトの実行が正常終了すると、何も表示せずに終了します。

エラー終了した場合は、次の点を確認して下さい。  
なお、処理中問題が発生した場合でもすぐにエラーとはせず、
何回か再接続してリトライするようにしています。

 1. $lf で指定したログファイルが残った場合  
    このスクリプトでは、
    冒頭に記したとおりファイルのアップロード動作を行います。  
    そのアップロードに失敗しました。  
    ログファイルを参照し、
    作業ディレクトリ($wdir)配下にあるファイルがFTPサーバにあるかどうかを、
    お手持ちのFTPツールで確認して下さい。  
    もしなければアップロードし直して下さい。  
    そして、ログファイルと、
    作業ディレクトリ配下にあるファイルを削除して下さい。
 2. 「dirメソッドの出力フォーマットが不正です」
    というエラーになった場合  
    「設定値1」内の $patd、$patf の変更が必要と思われます。
    (Perlの正規表現についての理解が必要となります。\_o\_)  
    このスクリプトでは、FTPサーバからファイル一覧を取得し、
    一覧の各行に対して正規表現を適用する事により、
    ファイル名/ディレクトリ名、パーミッション情報を得ています。  
    $patf が通常ファイル、$patd がディレクトリに対する正規表現ですので、
    スクリプトのコメントを参考にそれぞれ修正して下さい。  
    なお自分のファイルである事の判断は、この $patf 
    によって行っています。
 3. 更新はツリーの途中までしか行われていません。
    スクリプトを再度実行する事をお奨めします。

